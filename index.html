<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Calculate your luck in Pok√©mon TCG Pocket!"/>
  <title>Pok√©mon TCG Pocket Luck Calculator</title>
  <!-- Using Press Start 2P for a retro, Pok√©mon-inspired vibe -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
  <style>
    /* Subtle Pok√©ball background */
    .bg-decal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: url('https://upload.wikimedia.org/wikipedia/commons/5/53/Pokeball.png') repeat;
      opacity: 0.05;
      z-index: -1;
    }

    /* Overall styling */
    body {
      font-family: 'Press Start 2P', cursive;
      font-size: 14px;
      margin: 0;
      background: linear-gradient(135deg, #90CAF9, #F48FB1);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      overflow-x: hidden;
      position: relative;
    }
    input, button { font-family: 'Press Start 2P', cursive; }
    .luck-input { font-size: 0.8em; }

    /* Floating Pok√©mon decorations */
    @keyframes floatAround {
      0% { transform: translate(0, 0); }
      25% { transform: translate(30px, -20px); }
      50% { transform: translate(-20px, 30px); }
      75% { transform: translate(10px, -10px); }
      100% { transform: translate(0, 0); }
    }
    .floating-pokemon {
      position: fixed; z-index: 0;
      animation: floatAround 20s ease-in-out infinite;
    }
    .floating-pokemon.top-left { top: 10px; left: 10px; width: 60px; }
    .floating-pokemon.top-right { top: 10px; right: 10px; width: 60px; }
    .floating-pokemon.bottom-right { bottom: 10px; right: 10px; width: 60px; }
    .floating-pokemon.bottom-left { bottom: 10px; left: 10px; width: 60px; }
    .floating-pokemon img { width: 100%; height: auto; }

    /* Main container */
    .container {
      width: 100%;
      max-width: 600px;
      background-color: #FFF9C4;
      padding: 20px;
      border-radius: 15px;
      border: 3px solid #FFCA28;
      box-shadow: 0 6px 10px rgba(0,0,0,0.2);
      position: relative;
      background-image: url('https://via.placeholder.com/600x400?text=Pok%C3%A9mon+Card+Texture');
      background-size: cover;
      background-position: center;
      z-index: 1;
    }

    /* Title container with animated Pok√©ball icons */
    .title-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
    }
    .title-row {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
    }
    .title-container img {
      width: 120px; margin: 0 2px;
      animation: titleBallAnimation 1s ease-out;
    }
    @keyframes titleBallAnimation {
      0% { transform: scale(0); opacity: 0; }
      60% { transform: scale(1.2); opacity: 1; }
      80% { transform: scale(0.9); }
      100% { transform: scale(1); }
    }
    .page-title {
      font-size: 2em; color: #3E2723;
      text-shadow: 2px 2px 0 #FFF, 4px 4px 0 #FFEB3B;
      text-align: center;
    }
    .intro {
      background: rgba(255,255,255,0.8);
      padding: 10px 15px;
      border: 2px dashed #FFCA28;
      border-radius: 10px;
      margin-top: 10px;
      margin-bottom: 20px;
      text-align: center;
      font-size: 1em;
      color: #3E2723;
    }
    .section { margin-bottom: 20px; }

    /* Rarity cards grid */
    .rarity-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .rarity-grid .card {
      background: #FFEBCD;
      border: 2px solid #FFCA28;
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      opacity: 0;
      animation: fadeInUp 0.5s ease forwards;
    }
    .rarity-grid .card:nth-child(1) { animation-delay: 0.2s; }
    .rarity-grid .card:nth-child(2) { animation-delay: 0.4s; }
    .rarity-grid .card:nth-child(3) { animation-delay: 0.6s; }
    .rarity-grid .card:nth-child(4) { animation-delay: 0.8s; }
    .rarity-grid .card:nth-child(5) { animation-delay: 1s; }
    .rarity-grid .card:nth-child(6) { animation-delay: 1.2s; }
    .card label {
      font-size: 1em; display: block; margin-bottom: 5px; color: #424242;
    }
    .quad-diamonds-label { font-size: 1em; color: #424242; }
    .rare-label img {
      width: 40px; vertical-align: middle; margin-right: 5px;
    }
    .card input {
      width: 60px; padding: 5px; font-size: 1.1em;
      border: 1px solid #FFCA28; border-radius: 5px;
      text-align: center; transition: transform 0.2s;
    }
    .card input:focus {
      border-color: #D32F2F; box-shadow: 0 0 5px rgba(211,47,47,0.5);
      outline: none; transform: scale(1.1);
    }

    /* Packs Card */
    .packs-card {
      background: #FFEBCD;
      border: 2px solid #FFCA28;
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      width: 150px;
      margin: 0 auto 20px auto;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .packs-card:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .packs-card label {
      font-size: 0.8em;
      display: block;
      margin-bottom: 5px;
      color: #424242;
    }

    /* Submit button */
    .button {
      padding: 12px 20px;
      font-size: 0.9em; font-weight: bold;
      background-color: #D32F2F; color: white; border: none; cursor: pointer;
      border-radius: 8px; margin-top: 15px; transition: background-color 0.3s;
      display: block; margin-left: auto; margin-right: auto;
    }
    .button:hover { background-color: #B71C1C; }

    /* Result & Score styling */
    .result { margin-top: 10px; font-size: 0.8em; color: #424242; }
    .score-highlight {
      font-size: 1.4em; font-weight: bold; padding: 15px;
      border: 3px solid #D32F2F; border-radius: 10px;
      text-align: center; background-color: #FFCDD2;
      margin-bottom: 10px; transition: transform 0.4s;
    }
    .section h2 {
      font-size: 1.2em; color: #D32F2F;
      text-shadow: 1px 1px 0 #FFF; margin-bottom: 10px;
    }
    ul { list-style: none; padding: 0; }
    @keyframes slamIn {
      0% { opacity: 0; transform: scale(0.5) translateY(-50px); }
      60% { opacity: 1; transform: scale(1.1) translateY(10px); }
      80% { opacity: 1; transform: scale(0.95) translateY(0); }
      100% { opacity: 1; transform: scale(1) translateY(0); }
    }
    #luckByRarity li {
      background: #FFFDE7; margin-bottom: 10px; padding: 10px;
      border: 2px dashed #FFCA28; border-radius: 8px;
      font-size: 0.8em; opacity: 0; animation: slamIn 0.8s ease forwards;
    }
    #luckByRarity li:nth-child(1) { animation-delay: 1s; }
    #luckByRarity li:nth-child(2) { animation-delay: 2s; }
    #luckByRarity li:nth-child(3) { animation-delay: 3s; }
    #luckByRarity li:nth-child(4) { animation-delay: 4s; }
    #luckByRarity li:nth-child(5) { animation-delay: 5s; }
    #luckByRarity li:nth-child(6) { animation-delay: 6s; }
    .score-number { font-weight: bold; margin: 0 3px; }
    .score-number.green { color: green; }
    .score-number.red { color: red; }
    .arrow { font-size: 1.5em; margin-left: 5px; }
    .arrow.green { color: green; }
    .arrow.red { color: red; }
    #luckByRarity li em {
      color: #1976D2; display: block; margin-top: 10px;
    }
    .mascot {
      text-align: center; font-size: 1.2em; margin-top: 10px;
      font-weight: bold; color: #3E2723;
    }
    .pokemon-image {
      text-align: center; margin-top: 15px;
    }
    .pokemon-image img {
      width: 100px; height: auto;
      border: 2px solid #D32F2F; border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      animation: resultAnimation 1s ease-in-out;
    }
    @keyframes resultAnimation {
      0% { opacity: 0; transform: scale(0.5); }
      50% { opacity: 1; transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    .confetti {
      position: fixed; top: 0; width: 10px; height: 10px;
      opacity: 0.9; z-index: 9999; pointer-events: none;
      border-radius: 2px;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    .pulse { animation: pulse 1s infinite; }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-5px); }
      40% { transform: translateX(5px); }
      60% { transform: translateX(-5px); }
      80% { transform: translateX(5px); }
    }
    .shake { animation: shake 0.6s; }
    #resultsSection { display: none; }

    /* "How It Works" section */
    details {
      font-size: 0.8em; color: #3E2723;
      background: #FFFDE7; border: 2px dashed #FFCA28;
      padding: 10px; border-radius: 8px; margin-top: 10px;
    }
    details summary { cursor: pointer; font-weight: bold; }
    details p, details ul {
      margin: 10px 0; line-height: 1.4;
    }
    details ul li.toggle-info {
      margin-top: 5px; font-style: italic; color: #555;
    }

    /* Toggle card placed outside the Rare Pack card */
    .toggle-card {
      background: #FFEBCD;
      border: 2px solid #FFCA28;
      border-radius: 10px;
      padding: 8px;
      margin-top: 10px;
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .switch {
      position: relative;
      display: inline-block;
      width: 40px; height: 20px;
      vertical-align: middle;
    }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider {
      position: absolute; cursor: pointer;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: #ccc; transition: .4s;
      border-radius: 20px;
    }
    .slider:before {
      position: absolute; content: "";
      height: 14px; width: 14px;
      left: 3px; bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    .switch input:checked + .slider {
      background-color: #D32F2F;
    }
    /* Translate only 18px so it doesn't collide with label text */
    .switch input:checked + .slider:before {
      transform: translateX(18px);
    }
    .toggle-label {
      font-size: 0.7em; margin: 0;
    }
    .toggle-info-row {
      display: flex; align-items: center; justify-content: center;
      gap: 4px; /* slightly smaller gap */
    }
    .info-icon {
      font-size: 1em; cursor: pointer; vertical-align: middle;
    }
    .info-popup {
      display: none; font-size: 0.6em; background: #FFFDE7;
      border: 1px solid #FFCA28; padding: 5px;
      border-radius: 5px; margin-top: 5px;
      text-align: left;
    }

    /* Responsive layout for smaller screens */
    @media (max-width: 600px) {
      .container { width: 100%; padding: 10px; }
      .page-title { font-size: 1.5em; }
      .title-container img { width: 80px; }
      .luck-input { font-size: 0.7em; }
    }
  </style>
</head>
<body>
  <!-- Subtle background decal -->
  <div class="bg-decal"></div>

  <!-- Floating Pok√©mon decorations -->
  <div class="floating-pokemon top-left">
    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/25.png" alt="Pikachu">
  </div>
  <div class="floating-pokemon top-right">
    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/4.png" alt="Charmander">
  </div>
  <div class="floating-pokemon bottom-right">
    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/150.png" alt="Mewtwo">
  </div>
  <div class="floating-pokemon bottom-left">
    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/1.png" alt="Bulbasaur">
  </div>

  <div class="container">
    <!-- Title and Intro -->
    <div class="title-container">
      <div class="title-row">
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png" alt="Pok√©ball Icon">
        <div class="page-title">Pok√©mon TCG Pocket Luck Calculator</div>
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/25.png" alt="Pok√©ball Icon">
      </div>
      <div class="intro">
        Enter your card pull numbers and the number of packs opened to discover how lucky your pulls are!
      </div>
    </div>

    <!-- Rarity Inputs -->
    <div class="rarity-grid section">
      <div class="card">
        <label>üëë Crown Rares</label>
        <input type="number" id="crCards" min="0" class="luck-input" />
      </div>
      <div class="card">
        <label>‚≠ê‚≠ê‚≠ê Triple Stars</label>
        <input type="number" id="3sCards" min="0" class="luck-input" />
      </div>
      <div class="card">
        <label>‚≠ê‚≠ê Double Stars</label>
        <input type="number" id="2sCards" min="0" class="luck-input" />
      </div>
      <div class="card">
        <label>‚≠ê Single Stars</label>
        <input type="number" id="1sCards" min="0" class="luck-input" />
      </div>
      <div class="card">
        <label class="quad-diamonds-label">‚ô¶‚ô¶‚ô¶‚ô¶ Quad Diamonds</label>
        <input type="number" id="4dCards" min="0" class="luck-input" />
      </div>
      <div class="card">
        <label class="rare-label">
          <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/master-ball.png" alt="Master Ball Icon">
          Rare Packs
        </label>
        <input type="number" id="rareCards" min="0" class="luck-input" />
      </div>
    </div>

    <!-- The Toggle Card is now outside (just below) the Rare Packs card -->
    <div class="toggle-card">
      <div class="toggle-info-row">
        <label class="switch">
          <input type="checkbox" id="toggleRare" checked />
          <span class="slider"></span>
        </label>
        <span class="toggle-label">Include Rare in Score</span>
        <span class="info-icon" id="toggleInfo" tabindex="0">&#9432;</span>
      </div>
      <div class="info-popup" id="infoPopup">
        When enabled, Rare (God Pack) pulls affect your overall score with their full luck factor.
        When disabled, they are excluded from the overall calculation.
      </div>
    </div>

    <!-- Packs Opened -->
    <div class="packs-card section">
      <label>Packs Opened</label>
      <input type="number" id="packsOpened" min="0" class="luck-input" />
    </div>

    <button class="button" id="submitButton">Submit</button>
    <div id="errorHandling" class="result"></div>

    <!-- Results Section -->
    <div id="resultsSection">
      <div class="section">
        <div id="scoreBox" class="score-highlight"></div>
        <div id="luckRating" class="mascot"></div>
        <div id="pokemonImage" class="pokemon-image"></div>
      </div>
      <div class="section">
        <h2>Luck Score by Rarity:</h2>
        <div id="luckByRarity" class="result"></div>
      </div>
    </div>

    <!-- How It Works Section -->
    <details>
      <summary>How It Works</summary>
      <p><strong>Calculation Method:</strong></p>
      <ul>
        <li>
          For each rarity, the <strong>Luck Factor (%)</strong> is computed as:
          <span class="formula">(Actual Pulls √∑ Expected Pulls) √ó 100 ‚Äì 100</span>
        </li>
        <li>A 0% Luck Factor means you pulled exactly as expected.</li>
        <li>Positive values indicate extra pulls; negative values indicate fewer pulls.</li>
      </ul>
      <p><strong>Expected Pull Rates:</strong></p>
      <ul>
        <li>Crown Rares: 0.193%</li>
        <li>Triple Stars: 1.12%</li>
        <li>Double Stars: 2.55%</li>
        <li>Single Stars: 12.7%</li>
        <li>Quad Diamonds: 7.32%</li>
        <li>Rare (God Pack): 0.05%</li>
        <li class="toggle-info">
          <strong>Toggle:</strong> The "Include Rare in Score" switch controls Rare Packs‚Äô contribution.
          When enabled, Rare packs affect the overall score (normalized over 1200).
          When disabled, they are excluded (normalized over 1000).
        </li>
      </ul>
      <p>
        <strong>Note:</strong> Cards below Quad Diamonds are not tracked individually;
        they are assumed to be pulled at a 100% rate for every player.
      </p>
    </details>
  </div>

  <script>
    // IDs for saving input values locally
    const inputIds = ['crCards', '3sCards', '2sCards', '1sCards', '4dCards', 'rareCards', 'packsOpened'];

    document.addEventListener("DOMContentLoaded", () => {
      // Restore saved values
      inputIds.forEach(id => {
        const saved = localStorage.getItem(id);
        if (saved !== null) {
          document.getElementById(id).value = saved;
        }
      });

      // Real-time input validation
      const inputs = document.querySelectorAll('.luck-input');
      inputs.forEach((input, idx, arr) => {
        input.addEventListener('input', () => {
          const packs = parseInt(document.getElementById('packsOpened').value) || 0;
          if (packs > 0) {
            const maxPossible = packs * 5;
            const totalCards = Array.from(arr)
              .filter(inp => inp.id !== 'packsOpened')
              .reduce((sum, inp) => sum + (parseInt(inp.value) || 0), 0);

            if (totalCards > maxPossible) {
              document.getElementById('errorHandling').innerHTML =
                `The total cards entered (${totalCards}) exceed the maximum of ${maxPossible} for ${packs} pack(s)!`;
            } else {
              document.getElementById('errorHandling').innerHTML = '';
            }
          }
        });
      });

      // Randomize animation durations for floating Pok√©mon (8..15s)
      const floatingElements = document.querySelectorAll('.floating-pokemon');
      floatingElements.forEach(el => {
        const duration = Math.floor(Math.random() * 8) + 8;
        el.style.animationDuration = duration + 's';
      });
    });

    // Save user inputs
    function saveInputs() {
      inputIds.forEach(id => {
        const value = document.getElementById(id).value;
        localStorage.setItem(id, value);
      });
    }

    /* Original Rarity Descriptions + Confetti + etc. */
    /* (Identical to your previous code, fully compiled below) */

    const rarityDescriptionsOriginal = {
      ">=150": [
        "Legendary pull! It's like capturing a shiny Mewtwo‚Äîa once-in-a-lifetime achievement.",
        "Mythic result‚Äîlike catching Arceus on a truly magical day.",
        "Inconceivable‚Äîa pull that‚Äôs nothing short of legendary."
      ],
      ">=130": [
        "Phenomenal pull! Imagine finding a dazzling, shiny Ho-Oh.",
        "Spectacular pull‚Äîyour luck shines like a brilliant, shiny Ho-Oh.",
        "Incredible pull‚Äîas if fate itself granted you a shiny Ho-Oh."
      ],
      ">=110": [
        "Great pull! Like drawing an extra evolution card when you need it most.",
        "Nice pull‚Äîyour deck gets a boost, as if you uncovered a bonus card.",
        "Solid pull‚Äîa modest gain that feels like an extra spark of evolution."
      ],
      ">=90": [
        "Balanced pull‚Äîexactly as predicted, steady as your trusted starter.",
        "On target‚Äîlike a well-practiced deck, your pulls are spot on.",
        "Standard pull‚Äîmeeting expectations with reliable consistency."
      ],
      ">=75": [
        "Below par‚Äîlike a Caterpie still struggling to evolve.",
        "Not ideal‚Äîas if your chance for greatness was just out of reach.",
        "A little off‚Äînot quite what you hoped for on a rough day."
      ],
      ">=60": [
        "Mediocre pull‚Äîreminiscent of a Magikarp's feeble splash.",
        "Weak pull‚Äîas if luck took a day off, barely making a ripple.",
        "Subpar pull‚Äîfalling short like a splash that barely makes a mark."
      ],
      ">=45": [
        "Poor pull‚Äîlike a Slowpoke lagging behind; truly disappointing.",
        "Disastrous pull‚Äîas if even a Koffing had more spark.",
        "Critically low‚Äîa missed opportunity, like a Slowpoke that just can't keep up."
      ],
      ">=25": [
        "Catastrophic pull‚Äîalmost no luck, like a tiny Spearow lost among giants.",
        "Abysmal pull‚Äîas if your best card never saw the light of day.",
        "Utter failure‚Äîa pull so low it leaves little hope for a comeback."
      ],
      "else": [
        "No luck at all‚Äîa complete bust where even Magikarp only splashes.",
        "Absolute bust‚Äîan outcome that falls flat.",
        "Total failure‚Äîno positive pulls detected; an unfortunate day."
      ]
    };
    const zeroRarityDescriptions = {
      "üëë Crown Rare": [
        "No Crown Rares‚Äîevery legend has an off day.",
        "Zero Crown Rares‚Äîthe pinnacle remained elusive.",
        "No Crown Rares‚Äîthe highest tier slipped by."
      ],
      "‚≠ê‚≠ê‚≠ê Triple Star": [
        "No Triple Stars‚Äîthe brilliance did not shine today.",
        "Zero Triple Stars‚Äîa rare miss in this luminous category.",
        "No Triple Stars‚Äîthe spark of rarity was missing."
      ],
      "‚≠ê‚≠ê Double Star": [
        "No Double Stars‚Äîa disappointing void in this tier.",
        "Zero Double Stars‚Äîthe usual shine was absent.",
        "No Double Stars‚Äîa gap in your collection."
      ],
      "‚≠ê Single Star": [
        "No Single Stars‚Äîeven the common ones hid away.",
        "Zero Single Stars‚Äîa surprising void at the base level.",
        "No Single Stars‚Äîan unexpected miss in everyday pulls."
      ],
      "‚ô¶‚ô¶‚ô¶‚ô¶ Quadruple Diamond": [
        "No Quad Diamonds‚Äîthe gems failed to sparkle.",
        "Zero Quad Diamonds‚Äîthe rare jewels were nowhere to be found.",
        "No Quad Diamonds‚Äîthe shine of perfection was absent."
      ],
      "Rare (God Pack)": [
        "No Rare Pack cards‚Äîthe ultimate rarity was completely missed.",
        "Zero Rare Pack cards‚Äîthe jackpot remained locked.",
        "No Rare Pack cards‚Äîthe gods of rarity were silent."
      ]
    };
    let rarityDescriptions = JSON.parse(JSON.stringify(rarityDescriptionsOriginal));

    function pickUniqueDescription(rangeKey) {
      if (!rarityDescriptions[rangeKey] || rarityDescriptions[rangeKey].length === 0) {
        rarityDescriptions[rangeKey] = [...rarityDescriptionsOriginal[rangeKey]];
      }
      const arr = rarityDescriptions[rangeKey];
      const index = Math.floor(Math.random() * arr.length);
      return arr.splice(index, 1)[0];
    }
    function getRarityLuckDescription(score, rarityKey) {
      const luckScore = parseFloat(score);
      if (isNaN(luckScore)) return "";
      if (luckScore === 0 && zeroRarityDescriptions[rarityKey]) {
        const arr = zeroRarityDescriptions[rarityKey];
        const index = Math.floor(Math.random() * arr.length);
        return arr[index];
      }
      if (luckScore >= 150) return pickUniqueDescription(">=150");
      else if (luckScore >= 130) return pickUniqueDescription(">=130");
      else if (luckScore >= 110) return pickUniqueDescription(">=110");
      else if (luckScore >= 90) return pickUniqueDescription(">=90");
      else if (luckScore >= 75) return pickUniqueDescription(">=75");
      else if (luckScore >= 60) return pickUniqueDescription(">=60");
      else if (luckScore >= 45) return pickUniqueDescription(">=45");
      else if (luckScore >= 25) return pickUniqueDescription(">=25");
      else return pickUniqueDescription("else");
    }

    const overallBrackets = {
      ">=80": [
        { description: "Unstoppable‚Äîlike Mewtwo at full power!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/150.png", alt: "Mewtwo" },
        { description: "Legendary‚Äîas if you summoned Lugia on your best day!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/249.png", alt: "Lugia" },
        { description: "Mythical‚Äîakin to witnessing Rayquaza rule the skies!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/384.png", alt: "Rayquaza" }
      ],
      ">=65": [
        { description: "Impressive‚Äîlike Charizard blazing a trail in battle!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/6.png", alt: "Charizard" },
        { description: "Formidable‚Äîas if Tyranitar dominated the arena!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/248.png", alt: "Tyranitar" },
        { description: "Powerful‚Äîlike Salamence soaring in a storm!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/373.png", alt: "Salamence" }
      ],
      ">=50": [
        { description: "Steady‚Äîlike Onix holding strong as a fortress.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/95.png", alt: "Onix" },
        { description: "Reliable‚Äîlike Snorlax, a titan of persistence.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/143.png", alt: "Snorlax" },
        { description: "Solid‚Äîlike Golem, unyielding against all odds.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/76.png", alt: "Golem" }
      ],
      ">=35": [
        { description: "Moderate‚Äîlike Pikachu with a slight spark missing.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/25.png", alt: "Pikachu" },
        { description: "Average‚Äîlike Raichu just short of a full charge.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/26.png", alt: "Raichu" },
        { description: "Room for improvement‚Äîlike Jolteon needing that extra spark.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/135.png", alt: "Jolteon" }
      ],
      ">=20": [
        { description: "Underperforming‚Äîlike Rattata barely scurrying by.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/19.png", alt: "Rattata" },
        { description: "Disappointing‚Äîlike Pichu that just can‚Äôt spark.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/172.png", alt: "Pichu" },
        { description: "Lackluster‚Äîlike Sentret lost in the tall grass.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/161.png", alt: "Sentret" }
      ],
      "else": [
        { description: "Abysmal‚Äîlike Magikarp with no splash at all!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/129.png", alt: "Magikarp" },
        { description: "Pitiful‚Äîlike Zubat endlessly buzzing in the dark.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/41.png", alt: "Zubat" },
        { description: "Catastrophic‚Äîlike Ditto failing to transform your fate.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/132.png", alt: "Ditto" }
      ]
    };

    // Rarity sprite images
    const raritySprites = {
      "üëë Crown Rare": "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/150.png",
      "‚≠ê‚≠ê‚≠ê Triple Star": "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/6.png",
      "‚≠ê‚≠ê Double Star": "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/25.png",
      "‚≠ê Single Star": "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/1.png",
      "‚ô¶‚ô¶‚ô¶‚ô¶ Quadruple Diamond": "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/249.png",
      "Rare (God Pack)": "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/384.png"
    };

    function spawnRaritySprite(rarity) {
      // Implementation as above...
    }
    function spawnRandomBackgroundPokemon() {
      // Implementation as above...
    }
    setInterval(spawnRandomBackgroundPokemon, 2000);

    function launchConfetti() {
      // Implementation as above...
    }
    function launchSadConfetti() {
      // Implementation as above...
    }

    // Main calculation logic
    function calculateAllLuck() {
      const packsOpened = parseInt(document.getElementById('packsOpened').value) || 0;
      if (packsOpened <= 0) {
        document.getElementById('errorHandling').innerHTML = 'Please enter a valid number of opened packs.';
        return;
      }
      const totalCardsPulled =
        (parseInt(document.getElementById('crCards').value) || 0) +
        (parseInt(document.getElementById('3sCards').value) || 0) +
        (parseInt(document.getElementById('2sCards').value) || 0) +
        (parseInt(document.getElementById('1sCards').value) || 0) +
        (parseInt(document.getElementById('4dCards').value) || 0) +
        (parseInt(document.getElementById('rareCards').value) || 0);

      if (totalCardsPulled > packsOpened * 5) {
        document.getElementById('errorHandling').innerHTML =
          `Input Error: Total cards (${totalCardsPulled}) exceed maximum of ${packsOpened * 5} for ${packsOpened} pack(s).`;
        return;
      }
      document.getElementById('errorHandling').innerHTML = '';
      rarityDescriptions = JSON.parse(JSON.stringify(rarityDescriptionsOriginal));
      calculateScore();
      saveInputs();
    }

    function getLuckFactorWording(luckFactor) {
      if (luckFactor > 0) {
        return `You pulled <span class="score-number green">${luckFactor.toFixed(0)}%</span> more than expected. <span class="arrow green">‚Üë</span>`;
      } else if (luckFactor < 0) {
        return `You pulled <span class="score-number red">${Math.abs(luckFactor).toFixed(0)}%</span> fewer than expected. <span class="arrow red">‚Üì</span>`;
      } else {
        return `Exactly on the mark (as expected).`;
      }
    }

    function calculateScore() {
      const pulls = {
        "üëë Crown Rares": parseInt(document.getElementById('crCards').value) || 0,
        "‚≠ê‚≠ê‚≠ê Triple Star": parseInt(document.getElementById('3sCards').value) || 0,
        "‚≠ê‚≠ê Double Star": parseInt(document.getElementById('2sCards').value) || 0,
        "‚≠ê Single Star": parseInt(document.getElementById('1sCards').value) || 0,
        "‚ô¶‚ô¶‚ô¶‚ô¶ Quadruple Diamond": parseInt(document.getElementById('4dCards').value) || 0,
        "Rare (God Pack)": parseInt(document.getElementById('rareCards').value) || 0
      };
      const pullRates = {
        "üëë Crown Rares": 0.00193,
        "‚≠ê‚≠ê‚≠ê Triple Star": 0.0112,
        "‚≠ê‚≠ê Double Star": 0.0255,
        "‚≠ê Single Star": 0.127,
        "‚ô¶‚ô¶‚ô¶‚ô¶ Quadruple Diamond": 0.0732,
        "Rare (God Pack)": 1/2000
      };

      let resultsHTML = "<ul>";
      let totalLuck = 0;
      const packsOpened = parseInt(document.getElementById('packsOpened').value);
      const spawnedRarities = {};

      // Check toggle
      const includeRare = document.getElementById('toggleRare').checked;

      for (let rarity in pulls) {
        let actual = pulls[rarity];
        let expected = pullRates[rarity] * packsOpened;
        let luckDisplay = "";
        let desc = "";
        let contribution = 0;
        if (expected > 0) {
          let rawLuck = (actual / expected) * 100;
          let luckFactor = rawLuck - 100;
          if (actual === 0) {
            luckDisplay = "No pulls (below expected)";
            desc = getRarityLuckDescription(0, rarity);
          } else {
            luckDisplay = getLuckFactorWording(luckFactor);
            desc = getRarityLuckDescription(rawLuck, rarity);
            if (!spawnedRarities[rarity]) {
              spawnRaritySprite(rarity);
              spawnedRarities[rarity] = true;
            }
          }
          contribution = ((actual - expected) / expected) * 100;
          // Rare only included if toggle is on
          if (rarity === "Rare (God Pack)") {
            totalLuck += includeRare ? contribution : 0;
          } else {
            totalLuck += contribution;
          }
        } else {
          luckDisplay = "N/A";
        }
        resultsHTML += `
          <li>
            <strong>${rarity}:</strong> Actual: <span class="score-number">${actual}</span>,
            Expected: <span class="score-number">${expected.toFixed(1)}</span><br><br>
            <strong>Luck Factor:</strong> ${luckDisplay}<br><br>
            <em>${desc}</em>
          </li>`;
      }
      resultsHTML += "</ul>";
      document.getElementById('luckByRarity').innerHTML = resultsHTML;

      // Normalize
      let normalizedScore;
      if (includeRare) {
        // 6 rarities => ¬±600
        normalizedScore = ((totalLuck + 600) / 1200) * 100;
      } else {
        // 5 rarities => ¬±500
        normalizedScore = ((totalLuck + 500) / 1000) * 100;
      }
      normalizedScore = Math.min(Math.max(normalizedScore, 0), 100);
      let finalScore = normalizedScore.toFixed(0);

      // Display final
      document.getElementById('scoreBox').innerHTML = `<span class="score-number">${finalScore}</span>/100`;
      const scoreBoxEl = document.getElementById('scoreBox');
      scoreBoxEl.classList.remove('pulse', 'shake');
      if (finalScore >= 80) scoreBoxEl.classList.add('pulse');
      else if (finalScore < 35) scoreBoxEl.classList.add('shake');

      const overall = getOverallBracket(finalScore);
      document.getElementById('luckRating').innerHTML = overall.description;
      document.getElementById('pokemonImage').innerHTML = `<img class="result-pokemon" src="${overall.image}" alt="${overall.alt}" title="${overall.alt}" />`;
      document.getElementById('resultsSection').style.display = "block";

      if (finalScore >= 80) launchConfetti();
      else if (finalScore < 35) launchSadConfetti();
    }

    // Submit button triggers calculation
    document.getElementById('submitButton').addEventListener('click', calculateAllLuck);

    // Toggle info popup
    document.getElementById('toggleInfo').addEventListener('click', function(){
      const popup = document.getElementById('infoPopup');
      popup.style.display = (popup.style.display === "block") ? "none" : "block";
    });
  </script>
</body>
</html>